<!DOCTYPE html>
<html lang="pt-br">
<head>
    <script src="https://unpkg.com/@owlbear-rodeo/sdk"></script>
    <style>
        body { margin: 0; background: black; color: white; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; }
        #admin-panel { display: none; flex-direction: column; gap: 10px; padding: 20px; background: #222; border-radius: 8px; border: 1px solid #444; }
        #player-container { display: none; width: 100vw; height: 100vh; }
        iframe { width: 100%; height: 100%; border: none; }
        input { padding: 10px; border-radius: 4px; border: none; width: 280px; background: #333; color: white; }
        button { padding: 12px; cursor: pointer; background: #6200ee; color: white; border: none; border-radius: 4px; font-weight: bold; }
        button:hover { background: #7c22ff; }
    </style>
</head>
<body>

    <div id="admin-panel">
        <h3 style="margin:0 0 10px 0; text-align: center;">游꿟 Cinematic YouTube</h3>
        <input type="text" id="videoUrl" placeholder="Cole o link do YouTube aqui">
        <button onclick="sendVideo()">DAR PLAY PARA TODOS</button>
        <p style="font-size: 10px; color: #aaa; margin-top: 10px;">O v칤deo abrir치 em tela cheia para todos os jogadores.</p>
    </div>

    <div id="player-container">
        <iframe id="yt-iframe" allow="autoplay; encrypted-media; fullscreen"></iframe>
    </div>

    <script>
        const adminPanel = document.getElementById('admin-panel');
        const playerContainer = document.getElementById('player-container');
        const iframe = document.getElementById('yt-iframe');

        OBR.onReady(async () => {
            const role = await OBR.player.getRole();
            
            // S칩 mostra o painel de controle se for o Mestre
            if (role === "GM") {
                adminPanel.style.display = 'flex';
            }

            // Escuta o comando vindo de outros (ou de voc칡 mesmo)
            OBR.broadcast.onMessage("PLAY_CINEMATIC", (event) => {
                startCinematic(event.data.url);
            });
        });

        // Transforma link comum do YouTube em link de incorpora칞칚o (Embed)
        function getYoutubeEmbedUrl(url) {
            let videoId = "";
            if (url.includes("v=")) {
                videoId = url.split("v=")[1].split("&")[0];
            } else if (url.includes("be/")) {
                videoId = url.split("be/")[1].split("?")[0];
            }
            // Par칙metros: autoplay=1 (toca sozinho), controls=0 (esconde bot칫es), rel=0 (n칚o mostra v칤deos sugeridos)
            return `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1&rel=0&modestbranding=1`;
        }

        async function sendVideo() {
            const rawUrl = document.getElementById('videoUrl').value;
            if (!rawUrl) return alert("Cole um link v치lido!");
            
            const embedUrl = getYoutubeEmbedUrl(rawUrl);
            
            // Avisa todo mundo para abrir o v칤deo
            await OBR.broadcast.sendMessage("PLAY_CINEMATIC", { url: embedUrl });
            
            // Abre para o pr칩prio mestre
            startCinematic(embedUrl);
        }

        function startCinematic(url) {
            // Se j치 estivermos no modo "modal/tela cheia", apenas carrega o v칤deo
            if (window.location.search.includes("mode=video")) {
                adminPanel.style.display = 'none';
                playerContainer.style.display = 'block';
                iframe.src = url;
            } else {
                // Se estivermos no menu lateral, manda o Owlbear abrir o Modal gigante
                OBR.modal.open({
                    id: "cinematic-fullscreen",
                    url: window.location.href + (window.location.href.includes('?') ? '&' : '?') + "mode=video&url=" + encodeURIComponent(url),
                    fullScreen: true,
                });
            }
        }

        // Verifica se esta inst칙ncia da p치gina j치 nasceu para ser o v칤deo em tela cheia
        const params = new URLSearchParams(window.location.search);
        if (params.get('mode') === 'video') {
            const videoUrl = params.get('url');
            if (videoUrl) {
                adminPanel.style.display = 'none';
                playerContainer.style.display = 'block';
                iframe.src = videoUrl;
            }
        }
    </script>
</body>
</html>